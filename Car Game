import pygame
import time
import random

# Initialize Pygame
pygame.init()

# Display dimensions
DISPLAY_WIDTH, DISPLAY_HEIGHT = 800, 600
gameDisplay = pygame.display.set_mode((DISPLAY_WIDTH, DISPLAY_HEIGHT))
pygame.display.set_caption('A Bit Racey')
clock = pygame.time.Clock()

# Colors
BLACK = (0, 0, 0)
WHITE = (255, 255, 255)

# Load car image
carImg = pygame.image.load('racecar.png')
CAR_WIDTH, CAR_HEIGHT = carImg.get_size()

# Function to draw an obstacle
def draw_things(x, y, width, height):
    pygame.draw.rect(gameDisplay, BLACK, [x, y, width, height])

# Function to draw the car
def draw_car(x, y):
    gameDisplay.blit(carImg, (x, y))

# Function to display a message on the screen
def display_message(text):
    font = pygame.font.Font('freesansbold.ttf', 115)
    text_surface = font.render(text, True, BLACK)
    text_rect = text_surface.get_rect(center=(DISPLAY_WIDTH / 2, DISPLAY_HEIGHT / 2))
    gameDisplay.blit(text_surface, text_rect)
    pygame.display.update()
    time.sleep(2)

# Function to handle a crash event
def crash():
    display_message('You Crashed')

# Main game loop
def game_loop():
    x = DISPLAY_WIDTH * 0.45
    y = DISPLAY_HEIGHT * 0.8
    x_change = 0

    thing_startx = random.randrange(0, DISPLAY_WIDTH)
    thing_starty = -100
    thing_speed = 7
    thing_width, thing_height = 100, 100

    gameExit = False

    while not gameExit:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                quit()

            # Handle key press events for moving the car
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_LEFT:
                    x_change = -5
                elif event.key == pygame.K_RIGHT:
                    x_change = 5

            # Handle key release events to stop the car
            if event.type == pygame.KEYUP:
                if event.key == pygame.K_LEFT or event.key == pygame.K_RIGHT:
                    x_change = 0

        # Update car's x-coordinate
        x += x_change

        # Fill the screen with white color
        gameDisplay.fill(WHITE)

        # Draw obstacle and car
        draw_things(thing_startx, thing_starty, thing_width, thing_height)
        draw_car(x, y)

        # Move the obstacle down the screen
        thing_starty += thing_speed

        # Check if the car hits screen boundaries
        if x > DISPLAY_WIDTH - CAR_WIDTH or x < 0:
            crash()
            gameExit = True

        # Reset obstacle position when it moves off screen
        if thing_starty > DISPLAY_HEIGHT:
            thing_starty = 0 - thing_height
            thing_startx = random.randrange(0, DISPLAY_WIDTH)

        # Collision detection between the car and the obstacle
        if y < thing_starty + thing_height:
            if x < thing_startx + thing_width and x + CAR_WIDTH > thing_startx:
                crash()
                gameExit = True

        # Update the display
        pygame.display.update()

        # Frame rate
        clock.tick(60)

# Start the game loop
game_loop()

# Quit Pygame properly
pygame.quit()
quit()
